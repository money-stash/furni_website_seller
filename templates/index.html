<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link rel="shortcut icon" href="favicon.png" />

    <meta name="description" content="" />
    <meta name="keywords" content="bootstrap, bootstrap4" />

    <!-- Bootstrap CSS -->
    <link href="{{url_for('static', filename='css/bootstrap.min.css')}}" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
    <link href="{{url_for('static', filename='css/tiny-slider.css')}}" rel="stylesheet" />
    <link href="{{url_for('static', filename='css/style.css')}}" rel="stylesheet" />
    <link href="{{url_for('static', filename='css/index.css')}}" rel="stylesheet" />
    <title>Lotos</title>
    <style>
      .search-container {
        position: relative;
        max-width: 600px;
      }
      
      .search-input-wrapper {
        position: relative;
      }
      
      .search-input {
        width: 100%;
        padding: 12px 45px 12px 15px;
        border: 2px solid #3b5d50;
        border-radius: 25px;
        font-size: 16px;
        transition: all 0.3s ease;
      }
      
      .search-input:focus {
        outline: none;
        border-color: #2f4e43;
        box-shadow: 0 0 0 3px rgba(59, 93, 80, 0.1);
      }
      
      .search-icon {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #3b5d50;
        pointer-events: none;
      }
      
      .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        border-radius: 10px;
        margin-top: 5px;
        max-height: 400px;
        overflow-y: auto;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        display: none;
      }
      
      .search-results.active {
        display: block;
      }
      
      .search-result-item {
        display: flex;
        align-items: center;
        padding: 12px 15px;
        border-bottom: 1px solid #f0f0f0;
        cursor: pointer;
        transition: background-color 0.2s;
        text-decoration: none;
        color: inherit;
      }
      
      .search-result-item:hover {
        background-color: #f8f9fa;
      }
      
      .search-result-item:last-child {
        border-bottom: none;
      }
      
      .search-result-image {
        width: 50px;
        height: 50px;
        object-fit: cover;
        border-radius: 5px;
        margin-right: 15px;
        flex-shrink: 0;
      }
      
      .search-result-content {
        flex: 1;
      }
      
      .search-result-name {
        font-weight: 500;
        margin-bottom: 3px;
        color: #2f4e43;
      }
      
      .search-result-details {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: #6c757d;
      }
      
      .search-result-category {
        font-size: 13px;
      }
      
      .search-result-price {
        font-weight: 600;
        color: #3b5d50;
      }
      
      .search-no-results {
        padding: 20px;
        text-align: center;
        color: #6c757d;
      }
      
      .search-loading {
        padding: 20px;
        text-align: center;
        color: #3b5d50;
      }
    </style>
  </head>

  <body>

    <!-- Боковое меню -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <div class="sidebar-menu" id="sidebarMenu">
      <div class="sidebar-header">
        <h3>Всі категорії</h3>
        <button class="sidebar-close" id="sidebarClose">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="sidebar-content">
        {% for category in categories %}
        <div class="category-group">
          <a class="category-item" data-category-id="{{ category.id }}" href="{{ url_for('shop', category=(category.name)|lower) }}">
            <span class="category-name">{{ category.name }}</span>
            <i class="fas fa-chevron-right category-arrow"></i>
          </a>
          <div class="products-list" id="products-{{ category.id }}" style="display: none;">
            {% for product in products %}
              {% if product.category and product.category.id == category.id %}
              <div class="product-item">
                <a href="{{ url_for('product_info', product_id=product.id) }}">
                  {{ product.name }}
                </a>
              </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Start Header/Navigation -->
    <nav class="custom-navbar navbar navbar-expand-md navbar-dark bg-dark" aria-label="Furni navigation bar">
      <div class="container position-relative d-flex justify-content-between align-items-center">
        <a class="navbar-brand d-flex align-items-center gap-2" href="{{ url_for('index') }}">
          <img src="{{ url_for('static', filename='images/lotos_white.png') }}" alt="Lotos Logo" style="height: 62px; width: auto;">
          Lotos<span>.</span>
        </a>

        <!-- Иконки профиля и корзины всегда сверху -->
        <ul class="custom-navbar-cta navbar-nav mb-2 mb-md-0 d-flex flex-row profile-cart-icons">
          <li class="nav-item me-3">
            <a class="nav-link" href="{{ url_for('profile') }}">
              <img src="{{url_for('static', filename='images/user.svg')}}" />
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('cart') }}">
              <img src="{{url_for('static', filename='images/cart.svg')}}" />
            </a>
          </li>
        </ul>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsFurni" aria-controls="navbarsFurni" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsFurni">
          <ul class="custom-navbar-nav navbar-nav ms-auto mb-2 mb-md-0">
            <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}">Головна</a></li>
            <li class="{% if request.endpoint == 'categories_view' %}active{% endif %}"><a class="nav-link" href="{{ url_for('categories_view') }}">Магазин</a></li>
            <li><a class="nav-link" href="{{ url_for('about') }}">Про нас</a></li>
            <li><a class="nav-link" href="{{ url_for('services') }}">Послуги</a></li>
            <li><a class="nav-link" href="{{ url_for('contact') }}">Зв'яжіться з нами</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- End Header/Navigation -->

    <!-- Start Hero Section -->
    <div class="hero">
      <div class="container">
        <div class="row justify-content-between">
          <div class="col-lg-5">
            <div class="intro-excerpt">
              <h1>
                Інтернет магазин  <span clsas="d-block">сучасних меблів</span>
              </h1>
              <p>
                <a href="{{url_for('categories_view')}}" class="btn btn-secondary me-2">Купуйте зараз</a
                ><a href="{{url_for('categories_view')}}" class="btn btn-white-outline">Пошук</a>
              </p>
            </div>
          </div>
          <div class="col-lg-7">
            <div class="hero-img-wrap">
              <img class="krovat" src="{{url_for('static', filename='images/krovat-Photoroom.png')}}" class="img-fluid" />
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- End Hero Section -->

    <!-- Start Product Section -->
    <div class="product-section">
      <div class="container">
        <div class="row">
          <div class="col-md-12 col-lg-3 mb-5 mb-lg-0">
            <h2 class="mb-4 section-title">Пошук товарів</h2>
            <p class="mb-4">
              Виготовлено з якісних, перевірених матеріалів. Надійність, довговічність і стиль у кожному виробі.
            </p>
            
            <!-- Search Container -->
            <div class="search-container mb-4">
              <div class="search-input-wrapper">
                <input 
                  type="text" 
                  id="productSearch" 
                  class="search-input" 
                  placeholder="Введіть назву товару..."
                  autocomplete="off"
                />
                <i class="fas fa-search search-icon"></i>
              </div>
              <div class="search-results" id="searchResults"></div>
            </div>
            
            <p><button class="btn" id="openSidebar">Всі категорії</button></p>
          </div>

        {% if (categories is defined and categories|length > 0) or (selected_categories and selected_categories|length > 0) %}
          {% set cats = categories if categories is defined else selected_categories %}
          {% set cats = cats|sort(attribute='name') %}
          {% set cats = cats|sort(attribute='tier') %}
          <div class="col-12 col-md-9">
            <div class="row g-3">
              {% for cat in cats %}
              <div class="col-6 col-sm-6 col-md-4 col-lg-3">
                <a href="{{ url_for('shop', category=(cat.name)|lower) }}" class="text-decoration-none">
                  <div class="category-card card h-100 shadow-sm">
                    <div class="category-image">
                      {% if cat.image_url %}
                        <img src="{{ cat.image_url }}" alt="{{ cat.name }}" loading="lazy" />
                      {% elif cat.image_path %}
                        <img src="{{ url_for('static', filename=cat.image_path) }}" alt="{{ cat.name }}" loading="lazy" />
                      {% else %}
                        <div class="no-image">Немає фото</div>
                      {% endif %}
                    </div>
                    <div class="card-body d-flex align-items-center justify-content-center">
                      <h5 class="category-title text-center mb-0">{{ cat.name }}</h5>
                    </div>
                  </div>
                </a>
              </div>
              {% endfor %}
            </div>
          </div>
        {% else %}
          <div class="col-12 col-md-9">
            <div class="alert alert-info">Категорії не вибрані.</div>
          </div>
        {% endif %}
        </div>
      </div>
    </div>
    <!-- End Product Section -->


    <!-- Start Why Choose Us Section -->
    <div class="why-choose-section">
      <div class="container">
        <div class="row justify-content-between">
          <div class="col-lg-6">
            <h2 class="section-title">Чому варто обрати нас</h2>
            <p>
              Кожен виріб створений із любов'ю до деталей. Ми використовуємо лише перевірені матеріали, які поєднують міцність, довговічність і стиль.
            </p>

            <div class="row my-5">
              <div class="col-6 col-md-6">
                <div class="feature">
                  <div class="icon">
                    <img src="{{url_for('static', filename='images/truck.svg')}}" alt="Image" class="imf-fluid" />
                  </div>
                  <h3>Швидка доставка</h3>
                  <p>
                    Ми доставляємо меблі по всій Україні швидко та акуратно.
Ваше замовлення прибуде вчасно й у відмінному стані — без затримок та пошкоджень.
Вартість доставки розраховується згідно з тарифами перевізника або залежно від відстані.
Обирайте зручний спосіб отримання — кур'єром «Нової пошти» чи самовивіз із магазину в Полтаві, вул. Соборності, 72.
                  </p>
                </div>
              </div>

              <div class="col-6 col-md-6">
                <div class="feature">
                  <div class="icon">
                    <img src="{{url_for('static', filename='images/bag.svg')}}" alt="Image" class="imf-fluid" />
                  </div>
                  <h3>Зручні покупки онлайн</h3>
                  <p>
                    Обирайте меблі легко та з комфортом, не виходячи з дому.
Наш сайт має зручний інтерфейс, детальні фото та точні описи, щоб ви бачили, що купуєте.
Оформити замовлення можна в один клік, а наш менеджер зв'яжеться для підтвердження та уточнення деталей.
Онлайн-покупки з нами — це швидко, просто та надійно!
                  </p>
                </div>
              </div>

              <div class="col-6 col-md-6">
                <div class="feature">
                  <div class="icon">
                    <img
                      src="{{url_for('static', filename='images/support.svg')}}"
                      alt="Image"
                      class="imf-fluid"
                    />
                  </div>
                  <h3>Підтримка 24/7</h3>
                  <p>
                    Наша команда завжди поруч, щоб допомогти з вибором меблів, оформленням замовлення чи будь-якими питаннями.
Ми працюємо щодня з 10:00 до 20:00 — без вихідних.
Зв'язатися з нами можна через соціальні мережі, месенджери або телефоном — обирайте зручний спосіб, і ми швидко відповімо!
                  </p>
                </div>
              </div>

            </div>
          </div>

          <div class="col-lg-5">
            <div class="img-wrap">
              <img
                src="{{url_for('static', filename='images/why-choose-us-img.jpg')}}"
                alt="Image"
                class="img-fluid"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- End Why Choose Us Section -->

   <!-- Start We Help Section -->
  <div class="we-help-section">
    <div class="container">
      <div class="row align-items-center">
        <!-- Слайдер изображений -->
        <div class="col-lg-7 mb-5 mb-lg-0">
          <div id="weHelpCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
              <div class="carousel-item active">
                <img src="{{ url_for('static', filename='images/img-grid-1.jpg') }}" class="d-block w-100 rounded" alt="Image 1">
              </div>
              <div class="carousel-item">
                <img src="{{ url_for('static', filename='images/img-grid-2.jpg') }}" class="d-block w-100 rounded" alt="Image 2">
              </div>
              <div class="carousel-item">
                <img src="{{ url_for('static', filename='images/img-grid-3.jpg') }}" class="d-block w-100 rounded" alt="Image 3">
              </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#weHelpCarousel" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#weHelpCarousel" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>
        </div>

        <!-- Текстовая часть -->
        <div class="col-lg-5 ps-lg-5">
          <h2 class="section-title mb-4">
            Ми допоможемо вам створити сучасний дизайн інтер'єру
          </h2>
          <p>
            Ми віримо, що інтер'єр — це не просто меблі, а відображення вашого стилю та комфорту. Наша команда допоможе вам підібрати рішення, які гармонійно поєднують естетику, функціональність і сучасні тенденції.
          </p>

          <ul class="list-unstyled custom-list my-4">
            <li>Індивідуальний підбір меблів під ваш простір</li>
            <li>Допомога з вибором кольорів і матеріалів</li>
            <li>Розробка концепції дизайну під будь-який стиль</li>
          </ul>
          <p><a href="{{ url_for('categories_view') }}" class="btn btn-primary">Пошук</a></p>
        </div>
      </div>
    </div>
  </div>
  <!-- End We Help Section -->

    <!-- Start Footer Section -->
    <footer class="footer-section">
      <div class="container relative">       

        <div class="row g-5 mb-5">
          <div class="col-lg-4">
            <div class="mb-4 footer-logo-wrap">
              <a href="{{ url_for('index') }}" class="footer-logo d-flex align-items-center gap-2">
                <img src="{{ url_for('static', filename='images/lotos_dark.png') }}" alt="Lotos Logo" style="height:62px; width:auto;">
                Lotos<span>.</span>
              </a>
            </div>
            <p class="mb-4">
              Lotos — це більше, ніж просто магазин меблів. Ми створюємо простір, у якому вам хочеться жити, відпочивати й надихатись.
            </p>
            <p class="mb-2">
              <strong>Графік роботи:</strong> щодня з 10:00 до 20:00
            </p>
            <ul class="list-unstyled custom-social">
              <li>
                <a href="https://www.instagram.com/lotos_mebel_ua"><span class="fa fa-brands fa-instagram"></span></a>
                <a href="https://t.me/Artem050620" target="_blank"><span class="fa fa-brands fa-telegram"></span></a>
              </li>
            </ul>
          </div>

          <div class="col-lg-8">
            <div class="row links-wrap">
              <div class="col-6 col-sm-6 col-md-3">
                <ul class="list-unstyled">
                  <li><a class="nav-link" href="{{ url_for('about') }}">Про нас</a></li>
                  <li><a class="nav-link" href="{{ url_for('services') }}">Послуги</a></li>
                  <li><a class="nav-link" href="{{ url_for('contact') }}">Зв'яжіться з нами</a></li>
                </ul>
              </div>

              <div class="col-6 col-sm-6 col-md-3">
                <ul class="list-unstyled">
                  <li><a class="nav-link" href="{{ url_for('contact') }}">Послуги</a></li>
                </ul>
              </div>

              <div class="col-6 col-sm-6 col-md-3">
                <ul class="list-unstyled">
                  
                  <li><a href="{{ url_for('terms') }}"> Угода користувача </a></li>
                  <li><a class="nav-link" href="{{ url_for('guarantee') }}">Гарантія</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div class="border-top copyright">
          <div class="row pt-4">
            <div class="col-lg-6">
              <p class="mb-2 text-center text-lg-start">
                Copyright &copy;
                <script>
                  document.write(new Date().getFullYear());
                </script>
                . All Rights Reserved. &mdash; Designed with love
              </p>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!-- End Footer Section -->

    <script src="{{url_for('static', filename='js/bootstrap.bundle.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/tiny-slider.js')}}"></script>
    <script src="{{url_for('static', filename='js/custom.js')}}"></script>
    
    <script>
const sidebar = document.getElementById('sidebarMenu');
const overlay = document.getElementById('sidebarOverlay');
const openBtn = document.getElementById('openSidebar');
const closeBtn = document.getElementById('sidebarClose');

openBtn.addEventListener('click', () => {
  sidebar.classList.add('active');
  overlay.classList.add('active');
  document.body.style.overflow = 'hidden';
});

const closeSidebar = () => {
  sidebar.classList.remove('active');
  overlay.classList.remove('active');
  document.body.style.overflow = '';
};

closeBtn.addEventListener('click', closeSidebar);
overlay.addEventListener('click', closeSidebar);

document.querySelectorAll('.category-item').forEach(a => {
  a.addEventListener('click', function() {
    sidebar.classList.remove('active');
    overlay.classList.remove('active');
    document.body.style.overflow = '';
  });
});

const PRODUCTS = {{ products|tojson|safe }};

const searchInput = document.getElementById('productSearch');
const searchResults = document.getElementById('searchResults');
let searchTimeout = null;

function getProductImageHtml(p) {
  const urlCandidates = [];
  if (p.image_url) urlCandidates.push(p.image_url);
  if (p.image_path) urlCandidates.push(p.image_path);
  if (p.images && Array.isArray(p.images) && p.images.length) {
    if (p.images[0].url) urlCandidates.push(p.images[0].url);
    if (p.images[0].path) urlCandidates.push(p.images[0].path);
  }
  const src = urlCandidates.find(u => !!u) || null;
  if (src) {
    return `<img src="${src}" alt="${(p.name||'').replace(/"/g,'&quot;')}" class="search-result-image" />`;
  } else {
    return '<div class="search-result-image" style="background: #f0f0f0; display: flex; align-items: center; justify-content: center; color: #999;"><i class="fas fa-image"></i></div>';
  }
}

function formatPrice(p) {
  if (p == null || p === '' || isNaN(Number(p))) return '';
  return `${Number(p).toFixed(2)} грн`;
}

searchInput.addEventListener('input', function() {
  const query = this.value.trim().toLowerCase();
  if (searchTimeout) clearTimeout(searchTimeout);
  if (query.length < 2) {
    searchResults.classList.remove('active');
    searchResults.innerHTML = '';
    return;
  }
  searchResults.classList.add('active');
  searchResults.innerHTML = '<div class="search-loading"><i class="fas fa-spinner fa-spin"></i> Пошук...</div>';
  searchTimeout = setTimeout(() => {
    const matched = PRODUCTS.filter(p => {
      if (!p) return false;
      const name = (p.name || '').toString().toLowerCase();
      const desc = (p.description || '').toString().toLowerCase();
      const categoryName = (p.category && (p.category.name || p.category)) ? (p.category.name || p.category).toString().toLowerCase() : '';
      return name.includes(query) || desc.includes(query) || categoryName.includes(query);
    });
    if (matched.length === 0) {
      searchResults.innerHTML = '<div class="search-no-results">Товари не знайдено</div>';
    } else {
      const html = matched.slice(0, 30).map(product => {
        const imageHtml = getProductImageHtml(product);
        const categoryText = product.category ? (product.category.name || product.category) : '';
        const priceText = formatPrice(product.price);
        const safeName = (product.name||'').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
        const href = product.id ? `/product/${product.id}` : '#';
        return `<a href="${href}" class="search-result-item">
                  ${imageHtml}
                  <div class="search-result-content">
                    <div class="search-result-name">${safeName}</div>
                    <div class="search-result-details">
                      ${categoryText ? `<span class="search-result-category">${categoryText}</span>` : ''}
                      ${priceText ? `<span class="search-result-price">${priceText}</span>` : ''}
                    </div>
                  </div>
                </a>`;
      }).join('');
      searchResults.innerHTML = html;
    }
  }, 300);
});

document.addEventListener('click', function(e) {
  if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
    searchResults.classList.remove('active');
  }
});

searchInput.addEventListener('focus', function() {
  if (this.value.trim().length >= 2 && searchResults.innerHTML) {
    searchResults.classList.add('active');
  }
});
</script>


  </body>
</html>